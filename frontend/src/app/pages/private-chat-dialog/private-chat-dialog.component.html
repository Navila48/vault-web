<div class="fixed top-0 left-0 w-screen h-screen bg-white flex flex-col z-50">
  <!-- Header -->
  <div
    class="px-4 py-3 border-b font-semibold text-gray-800 flex justify-between items-center"
  >
    <span class="text-lg sm:text-xl">Chat with {{ username }}</span>
    <div class="flex items-center gap-2 flex-shrink-0">
      <button
        (click)="toggleSearch()"
        class="text-gray-500 hover:text-blue-600 transition-colors p-1"
        [class.text-blue-600]="isSearchOpen"
        aria-label="Toggle search"
        title="Search messages"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
      </button>
      <button
        (click)="onClose()"
        class="text-gray-500 hover:text-red-500 text-2xl sm:text-3xl leading-none"
        aria-label="Close chat"
      >
        âœ•
      </button>
    </div>
  </div>
  <!-- Search Bar -->
  <div
    *ngIf="isSearchOpen"
    class="px-4 py-2 border-b bg-gray-50 flex items-center gap-2"
  >
    <input
      #searchInput
      type="text"
      class="flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-md outline-none focus: border-blue-500 focus:ring focus:ring-blue-200"
      [(ngModel)]="searchQuery"
      name="search"
      autocomplete="off"
      placeholder="Search message"
    />
    <span class="text-xs text-gray-400 whitespace-nowrap">
      {{ filteredMessages.length }} / {{ messages.length }}
    </span>
  </div>
  <!-- Messagebox -->
  <div class="flex-1 overflow-y-auto p-4 space-y-2" #messageContainer>
    <div
      *ngFor="let msg of filteredMessages"
      class="flex"
      [ngClass]="{
        'justify-end': msg.senderUsername === currentUsername,
        'justify-start': msg.senderUsername !== currentUsername,
      }"
    >
      <div
        class="max-w-[75%] px-4 py-2 rounded-xl text-sm break-words"
        [ngClass]="{
          'my-message rounded-br-none': msg.senderUsername === currentUsername,
          'bg-gray-200 text-gray-900 rounded-bl-none':
            msg.senderUsername !== currentUsername,
        }"
      >
        {{ msg.content }}
      </div>
    </div>

    <div
      *ngIf="
        isSearchOpen && searchQuery.trim() && filteredMessages.length === 0
      "
      class="text-center text-sm text-gary-400 pt-8"
    >
      No message match for {{ searchQuery }}
    </div>
  </div>

  <!-- Input-Field -->
  <form (submit)="sendMessage()" class="flex border-t px-4 py-3">
    <input
      type="text"
      [(ngModel)]="newMessage"
      name="message"
      class="flex-1 px-3 py-2 outline-none border border-gray-300 rounded-l-md focus:border-blue-500 focus:ring focus:ring-blue-300"
      placeholder="Type a message..."
      autocomplete="off"
    />
    <button
      type="submit"
      class="px-5 bg-blue-600 text-white font-bold rounded-r-md hover:bg-blue-700 transition"
    >
      Send
    </button>
  </form>
</div>
